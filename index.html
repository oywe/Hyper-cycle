<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>IPを十進数で表示</title>
<style>
  body { font-family: sans-serif; padding: 20px; }
  #output { font-size: 1.5em; color: blue; }
</style>
</head>
<body>
<h1>過疎スタ民適正Id表示</h1>
<div id="output">取得中...</div>

<script>
// IPアドレスを十進数に変換
function ipToDecimal(ip) {
    return ip.split('.').reduce((acc, octet) => (acc << 8) + parseInt(octet), 0);
}

// WebRTCでIPを取得
async function getDecimalIP() {
    const output = document.getElementById('output');
    const ips = new Set();

    const pc = new RTCPeerConnection({ iceServers: [{ urls: "stun:stun.l.google.com:19302" }] });
    pc.createDataChannel("");

    pc.onicecandidate = (event) => {
        if (!event.candidate) return;
        const candidate = event.candidate.candidate;
        const ipMatch = candidate.match(/([0-9]{1,3}(\.[0-9]{1,3}){3})/);
        if (ipMatch) {
            const ip = ipMatch[1];
            if (!ips.has(ip)) {
                ips.add(ip);
                // 最初のIPを十進数で表示
                output.textContent = ipToDecimal(ip);
            }
        }
    };

    const offer = await pc.createOffer();
    await pc.setLocalDescription(offer);
}

// 実行
getDecimalIP();
</script>
</body>
</html>
